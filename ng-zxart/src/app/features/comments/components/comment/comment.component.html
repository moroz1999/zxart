<zx-stack spacing="lg">
  <zx-panel class="comment-panel" radius="lg" padding="lg">
    <zx-stack spacing="md">
      <zx-stack class="comment-header" direction="row" spacing="sm">
        <zx-user [user]="comment.author"></zx-user>
        <span class="comment-date" zxCaption>{{ comment.date }}</span>
      </zx-stack>

      <div class="comment-body">
        <div *ngIf="!showEditForm" class="comment-content" zxBody>
          <span [innerHTML]="safeContent"></span>
        </div>
        <app-comment-form
          *ngIf="showEditForm"
          [targetId]="comment.parentId || 0"
          [commentToEdit]="comment"
          (commentSaved)="onCommentSaved($event)"
          (cancelled)="showEditForm = false"
        ></app-comment-form>
      </div>

      <zx-stack *ngIf="!showEditForm" direction="row" spacing="md">
        <zx-button size="xs" color="secondary" (click)="onReply()">{{ 'comments.reply' | translate }}</zx-button>
        <zx-button *ngIf="comment.canEdit" size="xs" color="secondary"
                   (click)="onEdit()">{{ 'comments.edit' | translate }}
        </zx-button>
        <zx-button *ngIf="comment.canDelete" size="xs" color="danger"
                   (click)="onDelete()">{{ 'comments.delete' | translate }}
        </zx-button>
      </zx-stack>
    </zx-stack>
  </zx-panel>
  <zx-panel
    *ngIf="showReplyForm"
    radius="lg"
    padding="lg"
    [style.margin-left]="'var(--margin-xl)'"
  >
    <app-comment-form
      [targetId]="comment.id"
      (commentSaved)="onCommentSaved($event)"
      (cancelled)="showReplyForm = false"
    ></app-comment-form>
  </zx-panel>
  <app-comment
    *ngFor="let child of comment.children"
    [comment]="child"
    (commentChanged)="onCommentSaved(child)"
    [style.margin-left]="'var(--margin-xl)'"
  ></app-comment>
</zx-stack>
