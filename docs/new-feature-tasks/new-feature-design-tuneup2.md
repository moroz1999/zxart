# ТЗ: FilterPicker для радио-фильтров

## 0. Что исправляем и как сейчас работает
**Контекст:** экран *Music Player and Radio*, блок фильтров радио.

**Сейчас:**
- Страны, форматы и категории выбираются через обычные мультиселекты.
- Поля мелкие, выбранные значения плохо читаются.
- При большом количестве выбранных элементов пользователь не понимает, какие фильтры активны.

**Что исправляем:**
- Компоненты мультивыбора для **стран** и **форматов звучания**.

---

## 1. Цель
Сделать так, чтобы:
- в панели фильтров всегда было понятно, **что выбрано**;
- выбор из 30 стран и ~10 форматов был быстрым и наглядным;
- UI оставался компактным и не раздувал панель;
- логика radio criteria не менялась, менялся только UX.

---

## 2. Общее логическое решение
Использовать паттерн:

**FilterPicker = компактный summary-контрол + popover со списком чекбоксов**

- В панели отображается **summary выбранных значений**.
- Полный список и управление выбором находятся в popover.
- Изменения применяются **сразу**, без кнопки Apply.

---

## 3. Конкретные изменения по шагам

1. Ввести новый UI-компонент `zx-filter-picker`.
2. Заменить текущие мультиселекты:
    - **Страны** → `zx-filter-picker (multi)`
    - **Форматы звучания** → `zx-filter-picker (multi)`
    - **Категории (4 шт.)** не менять.
3. Поведение summary (закрытое состояние):
    - `0` выбрано → `Любые`
    - `1` выбрано → `A`
    - `2` выбрано → `A, B`
    - `>=3` выбрано → `A, B + N`
4. Popover:
    - открывается по клику на контрол
    - закрывается по `Esc` и клику вне
    - внутри:
        - список чекбоксов
        - поиск
        - кнопка **«Снять всё»** (disabled при пустом выборе)
5. Поиск:
    - для стран — включён всегда
    - для форматов — включён для единообразия
    - фильтрация по `label`, без учёта регистра
6. Применение:
    - клик по чекбоксу сразу обновляет `selected`
    - сразу обновляет radio criteria в родителе
7. Очистка:
    - в summary есть иконка clear
    - clear:
        - очищает выбор
        - **не открывает** popover
8. Активное состояние:
    - если `selected.length > 0`, контрол имеет визуальное состояние `active`
9. Логика radio criteria **не меняется**.

---

## 4. Изменения API и миграция

### Новый компонент `zx-filter-picker`

**Inputs:**
- `label: string`
- `items: Array<{ id: string; label: string }>`
- `selectedIds: string[]`
- `placeholder: string` (например, `Любые`)
- `searchEnabled: boolean`
- `multi: boolean` (в этом ТЗ всегда `true`)

**Outputs:**
- `selectedIdsChange: EventEmitter<string[]>`

---

### Изменения в родительском компоненте
1. Заменить существующие мультиселекты на `zx-filter-picker`.
2. Хранить выбранные значения как `string[]` id.
3. На `selectedIdsChange` пересобирать criteria так же, как сейчас.
4. Сохранение criteria (User Preferences / localStorage) остаётся без изменений.

---

## Проверки после внедрения
- корректное отображение summary (0 / 1 / 2 / много)
- clear работает и не открывает popover
- поиск фильтрует список
- критерии радио работают и сохраняются как раньше

## После завершения
- сделать build
- внести упоминания в domain, design-system